RoboRIO to Driver Station
=================================

UDP
---

Sent every 20ms in response to Driver Station packets, UDP port 1150

.. table::
   :widths: auto

   +---------------+--------+----------+-------------------------------------------------------+
   | Field         | Length | Type     | Comment                                               |
   +===============+========+==========+=======================================================+
   | Sequence Num  | 2      | uint16   |                                                       |
   +---------------+--------+----------+-------------------------------------------------------+
   | Comm Version  | 1      | uint8    | ``0x01`` is currently the only observed value         |
   +---------------+--------+----------+-------------------------------------------------------+
   | Status        | 1      | Status_  | Basically an echo if everything is operating properly |
   +---------------+--------+----------+-------------------------------------------------------+
   | Trace         | 1      | Trace_   |                                                       |
   +---------------+--------+----------+-------------------------------------------------------+
   | Battery       | 2      | Battery_ |                                                       |
   +---------------+--------+----------+-------------------------------------------------------+
   | Request Date? | 1      | uint8    | ``0x01`` when first connecting, ``0x00`` otherwise    |
   +---------------+--------+----------+-------------------------------------------------------+
   | Tags          | n      | Tags_    |                                                       |
   +---------------+--------+----------+-------------------------------------------------------+

.. _Status:

Status
^^^^^^

.. table::
   :widths: auto

   +----------------+--------------+-----------------------------------+
   | Field          | Mask         | Comment                           |
   +================+==============+===================================+
   | E-Stop         | ``x.......`` |                                   |
   +----------------+--------------+-----------------------------------+
   | Brownout       | ``...x....`` | 0: Normal, 1: Voltage Brownout    |
   +----------------+--------------+-----------------------------------+
   | Code Start     | ``....x...`` | 0: Running, 1: Initializing       |
   +----------------+--------------+-----------------------------------+
   | Enabled        | ``.....x..`` |                                   |
   +----------------+--------------+-----------------------------------+
   | Mode           | ``......xx`` | 0: Teleop, 1: Test, 2: Autonomous |
   +----------------+--------------+-----------------------------------+

.. _Trace:

Trace
^^^^^

.. table::
   :widths: auto

   +-----------------+--------------+----------------------------+
   | Field           | Mask         | Comment                    |
   +=================+==============+============================+
   | Robot Code      | ``..x.....`` |                            |
   +-----------------+--------------+----------------------------+
   | Is RoboRIO      | ``...x....`` |                            |
   +-----------------+--------------+----------------------------+
   | Test Mode       | ``....x...`` |                            |
   +-----------------+--------------+----------------------------+
   | Autonomous Mode | ``.....x..`` |                            |
   +-----------------+--------------+----------------------------+
   | TeleOp Code     | ``......x.`` |                            |
   +-----------------+--------------+----------------------------+
   | Disabled        | ``.......x`` |                            |
   +-----------------+--------------+----------------------------+

.. _Battery:

Battery
^^^^^^^

Received as a uint16, ``XXYY``. Voltage is calculated by:

`XX + YY/256`


.. _Tags:

Tags
^^^^

.. table::
   :widths: auto

   +-------+--------+-------+-----------------------------------------------+
   | Field | Length | Type  | Comment                                       |
   +=======+========+=======+===============================================+
   | Size  | 1      | uint8 |                                               |
   +-------+--------+-------+-----------------------------------------------+
   | ID    | 1      | uint8 | See table below                               |
   +-------+--------+-------+-----------------------------------------------+
   | Data  | n      |       | Depends on tag type                           |
   +-------+--------+-------+-----------------------------------------------+


.. table::
   :widths: auto

   +----------+-----------------------------+
   | ID       | Tag                         |
   +==========+=============================+
   | ``0x01`` | `Joystick Output`_          |
   +----------+-----------------------------+
   | ``0x04`` | `Disk Info`_                |
   +----------+-----------------------------+
   | ``0x05`` | `CPU Info`_                 |
   +----------+-----------------------------+
   | ``0x06`` | `RAM Info`_                 |
   +----------+-----------------------------+
   | ``0x08`` | `PDP Log`_                  |
   +----------+-----------------------------+
   | ``0x09`` | :ref:`Unknown <unknown_09>` |
   +----------+-----------------------------+
   | ``0x0e`` | `CAN Metrics`_              |
   +----------+-----------------------------+

.. _`joystick output`:

Joystick Output ``0x01``
""""""""""""""""""""""""
If multiple joysticks, the extended packets are concatenated together. If
a joystick isn't outputting anything, the size will be 1 (to include the packet
type ID) and not contain any of the below. So if the 3rd joystick is outputting,
it'll output `01 01 01 01 09 01 <below structure>`.

.. table::
   :widths: auto

   +--------------+--------+-----------+-----------------------------------------------+
   | Field        | Length | Type      | Comment                                       |
   +==============+========+===========+===============================================+
   | Outputs      | 4      | Output_   |                                               |
   +--------------+--------+-----------+-----------------------------------------------+
   | Left Rumble  | 2      | uint16    |                                               |
   +--------------+--------+-----------+-----------------------------------------------+
   | Right Rumble | 2      | uint16    |                                               |
   +--------------+--------+-----------+-----------------------------------------------+

Output
......

1 bit per output. Stored `LSB 0 <https://en.wikipedia.org/wiki/Bit_numbering#LSB_0_bit_numbering>`_.

.. _`disk info`:

Disk Info ``0x04``
""""""""""""""""""

.. table::
   :widths: auto

   +------------+--------+-----------+---------------------------+
   | Field      | Length | Type      | Comment                   |
   +------------+--------+-----------+---------------------------+
   | Free Space | 4      | uint32    | Number of bytes available |
   +------------+--------+-----------+---------------------------+


.. _`cpu info`:

CPU Info ``0x05``
"""""""""""""""""

.. table::
   :widths: auto

   +----------------------+--------+---------+-----------------------------------------------+
   | Field                | Length | Type    | Comment                                       |
   +======================+========+=========+===============================================+
   | Num of CPUs          | 4      | float   | `0x02` on the RoboRIO                         |
   +----------------------+--------+---------+-----------------------------------------------+
   | CPUn Time Critical % | 4      | float   |                                               |
   +----------------------+--------+---------+-----------------------------------------------+
   | CPUn Above Normal %  | 4      | float   |                                               |
   +----------------------+--------+---------+-----------------------------------------------+
   | CPUn Normal %        | 4      | float   |                                               |
   +----------------------+--------+---------+-----------------------------------------------+
   | CPUn Low %           | 4      | float   |                                               |
   +----------------------+--------+---------+-----------------------------------------------+

.. _`ram info`:

RAM Info ``0x06``
"""""""""""""""""

.. table::
   :widths: auto

   +------------+--------+-----------+---------------------------+
   | Field      | Length | Type      | Comment                   |
   +------------+--------+-----------+---------------------------+
   | Block      | 4      | uint32    |                           |
   +------------+--------+-----------+---------------------------+
   | Free Space | 4      | uint32    | Number of bytes available |
   +------------+--------+-----------+---------------------------+

.. _`pdp log`:

PDP Log ``0x08``
""""""""""""""""

.. table::
   :widths: auto

   +------------+--------+--------+----------+
   | Field      | Length | Type   | Comment  |
   +------------+--------+--------+----------+
   | Unknown    | 1      |        |          |
   +------------+--------+--------+----------+
   | PDP Stats  | 21     |        |          |
   +------------+--------+--------+----------+
   | Unknown    | 3      |        |          |
   +------------+--------+--------+----------+

The statistics for each PDP port is 10 bits, padding together for a total of 21
bytes.

.. code-block:: c

   struct PDP {
      uint16_t port_00 : 10; //
      uint16_t port_01 : 10; // 8 bytes, 40 bits
      uint16_t port_02 : 10; //
      uint16_t port_03 : 10; //
      uint16_t port_04 : 10; //
      uint16_t port_05 : 10; //
      uint16_t pad1    :  4; //

      uint16_t port_06 : 10; //
      uint16_t port_07 : 10; // 8 bytes, 40 bits
      uint16_t port_08 : 10; //
      uint16_t port_09 : 10; //
      uint16_t port_10 : 10; //
      uint16_t port_10 : 10; //
      uint16_t pad2    :  4; //

      uint16_t port_12 : 10; //
      uint16_t port_13 : 10; // 5 bytes, 40 bits
      uint16_t port_14 : 10; //
      uint16_t port_15 : 10; //
   }

.. _`unknown_09`:

Unknown ``0x09``
""""""""""""""""

.. table::
   :widths: auto

   +----------+--------+--------+----------+
   | Field    | Length | Type   | Comment  |
   +----------+--------+--------+----------+
   | Unknown  | 9      |        |          |
   +----------+--------+--------+----------+

.. _`can metrics`:

CAN Metrics ``0x0e``
""""""""""""""""""""

.. table::
   :widths: auto

   +---------------+--------+--------+----------+
   | Field         | Length | Type   | Comment  |
   +---------------+--------+--------+----------+
   | Utilization % | 4      | float  |          |
   +---------------+--------+--------+----------+
   | Bus Off       | 4      | uint32 |          |
   +---------------+--------+--------+----------+
   | TX Full       | 4      | uint32 |          |
   +---------------+--------+--------+----------+
   | RX Errors     | 1      | uint8  |          |
   +---------------+--------+--------+----------+
   | TX Errors     | 1      | uint8  |          |
   +---------------+--------+--------+----------+

.. _Tcp:

TCP
---

Sent over TCP port 1740. Strings are either prefixed with a length (specified)
or implied.

.. table::
   :widths: auto

   +----------+--------+--------+------------------------------------+
   | Field    | Length | Type   | Comment                            |
   +----------+--------+--------+------------------------------------+
   | Size     | 2      | uint16 | Including ID                       |
   +----------+--------+--------+------------------------------------+
   | ID       | 1      | uint8  | See table below (only if Size > 0) |
   +----------+--------+--------+------------------------------------+
   | Tags     | 1      |        | Depends on tag type                |
   +----------+--------+--------+------------------------------------+


Tags
^^^^

.. table::
   :widths: auto

   +----------+-----------------------------+
   | ID       | Tag                         |
   +----------+-----------------------------+
   | ``0x00`` | `Radio Events?`_            |
   +----------+-----------------------------+
   | ``0x01`` | `Usage Report`_             |
   +----------+-----------------------------+
   | ``0x04`` | `Disable Faults`_           |
   +----------+-----------------------------+
   | ``0x05`` | `Rail Faults`_              |
   +----------+-----------------------------+
   | ``0x0a`` | `Version Info`_             |
   +----------+-----------------------------+
   | ``0x0b`` | `Error Message`_            |
   +----------+-----------------------------+
   | ``0x0c`` | `Standard Output`_          |
   +----------+-----------------------------+
   | ``0x0d`` | :ref:`Unknown <unknown_0d>` |
   +----------+-----------------------------+

.. _`radio events?`:

Radio Events? ``0x00``
""""""""""""""""""""""

*Might just be generic "Error Strings" or something.*

.. table::
   :widths: auto

   +------------+--------+--------+----------+
   | Field      | Length | Type   | Comment  |
   +------------+--------+--------+----------+
   | Message    | n      | string |          |
   +------------+--------+--------+----------+

.. code-block: none

   Warning <Code> 44008 <radioLostEvents> 16.008 <radioSeenEvents> 14.507\n

.. _`usage report`:

Usage Report ``0x01``
"""""""""""""""""""""

.. table::
   :widths: auto

   +--------------+--------+------------+---------------------------------------------+
   | Field        | Length | Type       | Comment                                     |
   +==============+========+============+=============================================+
   | Team Num     | 2      | string     |                                             |
   +--------------+--------+------------+---------------------------------------------+
   | Unknown      | 1      | uint8      |                                             |
   +--------------+--------+------------+---------------------------------------------+
   | Entries      | n      | Entry Data |                                             |
   +--------------+--------+------------+---------------------------------------------+

.. _`disable faults`:

Disable Faults ``0x04``
"""""""""""""""""""""""

.. table::
   :widths: auto

   +--------------+--------+--------+---------------------------------------------+
   | Field        | Length | Type   | Comment                                     |
   +==============+========+========+=============================================+
   | Comms        | 2      | uint16 |                                             |
   +--------------+--------+--------+---------------------------------------------+
   | 12V          | 2      | uint16 |                                             |
   +--------------+--------+--------+---------------------------------------------+

.. _`rail faults`:

Rail Faults ``0x05``
""""""""""""""""""""

.. table::
   :widths: auto

   +--------------+--------+--------+---------------------------------------------+
   | Field        | Length | Type   | Comment                                     |
   +==============+========+========+=============================================+
   | 6V           | 2      | uint16 |                                             |
   +--------------+--------+--------+---------------------------------------------+
   | 5V           | 2      | uint16 |                                             |
   +--------------+--------+--------+---------------------------------------------+
   | 3.3V         | 2      | uint16 |                                             |
   +--------------+--------+--------+---------------------------------------------+

.. _`version info`:

Version Info ``0x0a``
"""""""""""""""""""""

.. table::
   :widths: auto

   +--------------+--------+------------+------------------------------+
   | Field        | Length | Type       | Comment                      |
   +==============+========+============+==============================+
   | Type         | 1      | `Device`_  | See below                    |
   +--------------+--------+------------+------------------------------+
   | Unknown      | 2      |            |                              |
   +--------------+--------+------------+------------------------------+
   | ID           | 1      | uint8      | CAN ID?                      |
   +--------------+--------+------------+------------------------------+
   | Name         | 1 + n  | string     |                              |
   +--------------+--------+------------+------------------------------+
   | Version      | 1 + n  | string     |                              |
   +--------------+--------+------------+------------------------------+

Empty message (``00 00 00 00 00 00``) signifies end of list.

.. _device:

Device Type
............

.. table::
   :widths: auto

   +-----+---------------------------------------------------+
   | Num | Type                                              |
   +=====+===================================================+
   | 0   | Software (``roboRIO image``, ``FRC_Lib_Version``) |
   +-----+---------------------------------------------------+
   | 2   | CA N Talon                                        |
   +-----+---------------------------------------------------+
   | 8   | PDP                                               |
   +-----+---------------------------------------------------+
   | 9   | PCM                                               |
   +-----+---------------------------------------------------+

.. _`error message`:

Error Message ``0x0b``
""""""""""""""""""""""

Shows up in main Driver Station log. Sequence Number increments along with Standard Output.

.. table::
   :widths: auto

   +------------+--------+--------+--------------------------------------+
   | Field      | Length | Type   | Comment                              |
   +============+========+========+======================================+
   | Timestamp  | 4      | float  | Seconds since start of log           |
   +------------+--------+--------+--------------------------------------+
   | SeqNum     | 2      | uint16 |                                      |
   +------------+--------+--------+--------------------------------------+
   | PrintMsg   | 1      | bool   | Only seen as ``01``. See note below. |
   +------------+--------+--------+--------------------------------------+
   | Error Code | 2      | uint16 |                                      |
   +------------+--------+--------+--------------------------------------+
   | Is Error   | 1      | bool   | True if error, False if warning      |
   +------------+--------+--------+--------------------------------------+
   | Details    | 2 + n  | string |                                      |
   +------------+--------+--------+--------------------------------------+
   | Location   | 2 + n  | string |                                      |
   +------------+--------+--------+--------------------------------------+
   | Call Stack | 2 + n  | string |                                      |
   +------------+--------+--------+--------------------------------------+

.. code-block: c

   int32_t HAL_SendError(HAL_Bool isError, int32_t errorCode, HAL_Bool isLVCode,
                        const char* details, const char* location,
                        const char* callStack, HAL_Bool printMsg);

C++ code only ever calls this with a false ``isLVCode`` and a true ``printMsg``.
Since the parameter is always true, it's probably ``printMsg``.

.. _`standard output`:

Standard Output ``0x0c``
""""""""""""""""""""""""

Sequence Number increments along with Error Message.

.. table::
   :widths: auto

   +-----------+--------+--------+----------------------------+
   | Field     | Length | Type   | Comment                    |
   +===========+========+========+============================+
   | Timestamp | 4      | float  | Seconds since start of log |
   +-----------+--------+--------+----------------------------+
   | SeqNum    | 2      | uint16 |                            |
   +-----------+--------+--------+----------------------------+
   | Message   | n      | string |                            |
   +-----------+--------+--------+----------------------------+

.. _`unknown_0d`:

Unknown ``0x0d``
""""""""""""""""

``00 00 04 04 04 04``
